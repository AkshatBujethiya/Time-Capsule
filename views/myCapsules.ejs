<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Capsules</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        function startCountdown(unlockDate, lockDate, elementId) {
            const countDownDate = new Date(unlockDate).getTime();
            const lockDateTime = new Date(lockDate).getTime();
            const countdownElement = document.getElementById(elementId);

            const updateCountdown = setInterval(function() {
                const now = new Date().getTime();
                const distance = countDownDate - now;
                const lockDistance = lockDateTime - now;

                if (lockDistance > 0) {
                    countdownElement.innerHTML = "Open until " + new Date(lockDate).toLocaleString();
                    return;
                }

                if (distance < 0) {
                    clearInterval(updateCountdown);
                    countdownElement.innerHTML = "Unlocked";
                    return;
                }

                const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((distance % (1000 * 60)) / 1000);

                countdownElement.innerHTML = `${days}d ${hours}h ${minutes}m ${seconds}s`;
            }, 1000);
        }
    </script>
</head>
<body class="bg-gradient-to-r from-pink-500 to-purple-700 min-h-screen flex flex-col items-center p-6">

    <!-- Page Title -->
    <h1 class="text-5xl font-bold text-black mb-8 text-center"><%= username %> Capsules</h1>
    <a href="/dashboard">
        <img src="/images/background1.png" alt="Virtual Time Capsule" class="top-10 flex items-center absolute left-8 w-8 h-8 object-contain hover:opacity-80 transition">
    </a>

    <!-- Containers Wrapper -->
    <div class="w-full flex flex-col lg:flex-row justify-center gap-8">

        <!-- Future Capsules Container -->
        <div class="w-full lg:w-1/2 bg-white bg-opacity-20 backdrop-blur-md shadow-lg rounded-lg p-8 border-1 border-blue-400">
            <h2 class="text-3xl font-semibold text-white mb-4 text-center">Future Capsules</h2>
            <div class="space-y-4">
                <% lockedCapsules.forEach(function(capsule, index) { %>
                    <div class="bg-white rounded-lg shadow-md p-4 transition transform hover:scale-105 cursor-pointer">
                        <h2 class="text-1xl font-semibold mb-2"><%= capsule.capsuleName %></h2>
                        <p class="text-red-500 font-bold" id="countdown-locked-<%= index %>">Loading...</p>
                        <p class="text-gray-500 text-sm">Created on: <%= new Date(capsule.createdAt).toLocaleString() %></p>
                        <script>
                            startCountdown('<%= capsule.unlockDate %>', '<%= capsule.lockDate %>', 'countdown-locked-<%= index %>');
                        </script>
                    </div>
                <% }); %>
            </div>
        </div>

        <!-- Opened Capsules Container -->
        <div class="w-full lg:w-1/2 bg-white bg-opacity-20 backdrop-blur-md shadow-lg rounded-lg p-8 border-1 border-blue-400">
            <h2 class="text-3xl font-semibold text-white mb-4 text-center">Opened Capsules</h2>
            <div class="space-y-4">
                <% unlockedCapsules.forEach(function(capsule) { %>
                    <div class="bg-white rounded-lg shadow-md p-4 transition transform hover:scale-105 cursor-pointer"
                         onclick="location.href='/capsule/<%= capsule.id %>'">
                        <h2 class="text-1xl font-semibold mb-2"><%= capsule.capsuleName %></h2>
                        <p class="text-green-500 font-bold">Unlocked</p>
                        <p class="text-gray-500 text-sm">Created on: <%= new Date(capsule.createdAt).toLocaleString() %></p>
                    </div>
                <% }); %>
                <% openCapsules.forEach(function(capsule, index) { %>
                    <div class="bg-white rounded-lg shadow-md p-4 transition transform hover:scale-105 cursor-pointer"
                         onclick="location.href='/capsule/<%= capsule.id %>'">
                        <h2 class="text-1xl font-semibold mb-2"><%= capsule.capsuleName %></h2>
                        <p class="text-red-500 font-bold" id="countdown-open-<%= index %>">Loading...</p>
                        <p class="text-gray-500 text-sm">Created on: <%= new Date(capsule.createdAt).toLocaleString() %></p>
                        <script>
                            startCountdown('<%= capsule.unlockDate %>', '<%= capsule.lockDate %>', 'countdown-open-<%= index %>');
                        </script>
                    </div>
                <% }); %>
            </div>
        </div>

    </div>

</body>
</html>
